/**
 */
////////////////////////////////////////////////////////////////////////////////
// Includes
////////////////////////////////////////////////////////////////////////////////
#include "clientInput_manager.h"

////////////////////////////////////////////////////////////////////////////////
// Private Structs
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Private Variables
////////////////////////////////////////////////////////////////////////////////
static char *(*clientInput_get) (const char*);
////////////////////////////////////////////////////////////////////////////////
// Private Functions Head
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Private Functions Inline
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Private Functions
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Construct Functions
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Public Functions
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Interface
////////////////////////////////////////////////////////////////////////////////
bool
CWeb_ClientInput_Init()
{
	char *rm = getenv("REQUEST_METHOD");
	if(rm == NULL) {
		fprintf(stderr, "CWEB - CLIENT INPUT - getenv(\"REQUEST_METHOD\") is NULL");
		return false;
	}
	
	// descobre qual o REQUEST_METHOD passado
	if(strcmp(rm, "GET") == 0) {
		clientInput_get = ClientInput_Get_StrMap_Get;
		return CWeb_ClientInput_Get_Init();
	}
	else if(strcmp(rm, "POST") == 0) {
		char *ct = getenv("CONTENT_TYPE");
		if(ct == NULL) {
			Error("CWEB - CLIENT INPUT - REQUEST_METHOD is POST\n"
				"CONTENT_TYPE expected is \"application/x-www-form-urlencoded\"\n"
				"CONTENT_TYPE passed is \"%s\"", ct);
		}
		else if(strcmp(ct, "application/x-www-form-urlencoded") != 0) {
			Error("CWEB - CLIENT INPUT - REQUEST_METHOD is POST\n"
				"CONTENT_TYPE expected is \"application/x-www-form-urlencoded\"\n"
				"CONTENT_TYPE passed is \"%s\"", ct);
		}
		clientInput_get = ClientInput_Post_StrMap_Get;
		return CWeb_ClientInput_Post_Init();
	}
	else {
		Error("CWEB - CLIENT INPUT - REQUEST_METHOD do not recognize.\n"
			"REQUEST_METHOD = \"%s\"", rm);
	}
	
	return false;
}

char*
CWeb_ClientInput(const char *key)
{
	return clientInput_get(key);
}










